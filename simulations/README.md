# README.md

## About the mechanistic simulations
We implemented a computational model that simulates drift in communities undergoing dilution-growth cycles. At each cycle, the community is first randomly subsampled to mimic experimental dilution. Then, 
the community grows by adding one new individual at each step until the pre-dilution community size is reached. At each growth step, the probability for each population to grow equals its actual relative 
abundance. The process thus models neutral growth along a passage experiment where all individuals have equal fitness.

We also introduced a second modelling scenario ("constrained neutrality") where the initial community populations are initially split into different groups, which then are subjected to the above dilution-growth cycles independently with different pre-set per group community sizes. The output contains each final community or all trajectory communities depending on the settings. The number of transfers and dilution rates employed (12 and 0.008, respectively) were those employed by Goldford _et al._ in their experiments. The initial simulated communities reflected the starting community compositions of their experiments and the community size matched its respective sequencing depths. Thus, this scenario limits growth using the observed average relative abundance of each PCGs in the glucose experiment. This abundance is 71.5% for Node35562 (related to Enterobacteriaceae), 21% for Node27828 (related to Pseudomonadaceae) and 7.5% for a group containing all other OTUs.


## Dataset
The initial ("original") abundances tables and their metadata maps are in `simulation_parameters` alongside the abundance table for endpoint communities (`table_tr12.txt`).

## Simulation scripts

   - `generate_simulations.sh` is a wrapper for generating the neutral and constrained-neutral simulations for both the original transfer and the transfer 1 transfer featured in this publication. This wrapper calls the included `dilgrowth_goldford.R` script. The code has since then been updated to include more options and make it more generalizable, faster C++ code for the speed-limiting growth step and easier input format. You can find it as an R package [here](https://github.com/silvtal/dilgrowth)

   - The rest of the .R and .cpp files are complementary scripts

## Analysis scripts

These scripts analyze the abundance tables generated by the simulation scripts. The included results are the ones analyzed in the publication.

- analysis_launcher.R
   - my_neutral_model_analysis_distr.R --> all the OTUs are considered equal, without taking into consideration their PCG (`simulation_results/my_neutral_model_glc`). Computes faith's PD, shannon's div, Pielou's evenness and the observed richness. Plots ECDF (extra options: Kolmigoroff-Smirnov + plot_boxplots inside the ECDF plot)
   - my_neutral_model_analysis_distr_PERC.R --> Reads all the separate simulations (3 simul types, one per PCG, applying fixed percentages; `my_neutral_model_glc_PERC`), puts them together and obtains metrics and ECDF.

- boxplots_by_metric_Fig4.R(SupplFig3)
   - graphical comparison of real vs. neutral vs. constrained neutral

- comparisons_by_metric_Fig4.R(SupplFig3)
   - DTS real vs. simul vs. simul w/ constraints. Asterisks at Figure 4 / Supplementary Figure 3.
